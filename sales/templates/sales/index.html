{% extends 'sales/layout.html' %}

{% block title %}MajiM√≥veis | Encontre o im√≥vel ideal{% endblock %}

{% block filter %}
  {% include 'sales/partials/filter_form.html' %}
{% endblock %}

{% block content %}
<div class="container">

  <!-- Bot√µes de navega√ß√£o entre abas -->
  <div class="text-center my-4">
    <button class="btn btn-outline-secondary mx-2" data-page="disliked">üëé Rejeitados</button>
    <button class="btn btn-outline-primary mx-2" data-page="new">üÜï Novos</button>
    <button class="btn btn-outline-success mx-2" data-page="liked">üëç Curtidos</button>
  </div>

  <!-- Aba: Rejeitados -->
  <div id="disliked" class="property-tab hidden">
    <h4 class="mb-3">üëé Im√≥veis Rejeitados</h4>
    <div class="properties-container">
      {% for property in imos_disliked %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Voc√™ ainda n√£o rejeitou nenhum im√≥vel.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Aba: Novos -->
  <div id="new" class="property-tab">
    <h4 class="mb-3">üÜï Novos Im√≥veis</h4>
    <div class="properties-container">
      {% for property in imos %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Nenhum im√≥vel dispon√≠vel no momento.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Aba: Curtidos -->
  <div id="liked" class="property-tab hidden">
    <h4 class="mb-3">üëç Im√≥veis Curtidos</h4>
    <div class="properties-container">
      {% for property in imos_liked %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Voc√™ ainda n√£o curtiu nenhum im√≥vel.</p>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Modal de Imagens -->
<!-- Modal de Imagens -->
<div id="fullscreen-modal" class="fullscreen-modal hidden">
  <span class="close" onclick="closeFullscreen()">&times;</span>
  <button id="prev-image" class="nav-arrow">&#10094;</button>
  <div id="modal-content" class="modal-content"></div>
  <button id="next-image" class="nav-arrow">&#10095;</button>
</div>


<!-- Estilo adicional -->
<style>
      .fullscreen-modal {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.85);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.fullscreen-modal.active {
  display: flex !important;
}

.modal-content {
  max-width: 90vw;
  max-height: 90vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.modal-content img {
  max-width: 90vw;
  max-height: 80vh;
  border-radius: 10px;
  animation: fadeIn 0.4s ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

.nav-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 3rem;
  color: white;
  background: transparent;
  border: none;
  cursor: pointer;
  z-index: 10000;
  padding: 1rem;
}

#prev-image { left: 20px; }
#next-image { right: 20px; }

.close {
  position: absolute;
  top: 20px;
  right: 30px;
  color: white;
  font-size: 2rem;
  cursor: pointer;
  z-index: 10001;
}


      .hidden {
    display: none !important;
  }

  .property-tab {
    margin-top: 1rem;
  }

  .properties-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  /* üëâ Scroll horizontal para mobile */
  @media (max-width: 768px) {
    .properties-container {
      overflow-x: auto;
      flex-wrap: nowrap;
      scroll-snap-type: x mandatory;
    }

    .property-card {
      flex: 0 0 auto;
      width: 80%;
      scroll-snap-align: start;
    }
  }

  /* ‚ú® Anima√ß√£o de entrada suave */
  .property-card {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease forwards;
  }

  .property-card:nth-child(1) { animation-delay: 0s; }
  .property-card:nth-child(2) { animation-delay: 0.1s; }
  .property-card:nth-child(3) { animation-delay: 0.2s; }
  .property-card:nth-child(4) { animation-delay: 0.3s; }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Modal fullscreen */
  .fullscreen-modal {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .fullscreen-modal.active {
    display: flex !important;
  }

  .fullscreen-modal .modal-content img {
    max-height: 90vh;
    max-width: 90vw;
  }

  .fullscreen-modal .close {
    position: absolute;
    top: 20px; right: 30px;
    color: white;
    font-size: 2rem;
    cursor: pointer;
  }

  .hidden {
    display: none !important;
  }

  .fullscreen-modal {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .fullscreen-modal.active {
    display: flex !important;
  }

  .fullscreen-modal .modal-content img {
    max-height: 90vh;
    max-width: 90vw;
  }

  .fullscreen-modal .close {
    position: absolute;
    top: 20px; right: 30px;
    color: white;
    font-size: 2rem;
    cursor: pointer;
  }

  .property-tab {
    margin-top: 1rem;
  }
</style>

<!-- Scripts de comportamento -->
<script>
  let imageUrls = [];
  let currentImageIndex = 0;

  document.addEventListener('DOMContentLoaded', function () {
    const buttons = document.querySelectorAll('button[data-page]');
    const tabs = document.querySelectorAll('.property-tab');

    // Altern√¢ncia de abas
    buttons.forEach(button => {
      button.addEventListener('click', () => {
        tabs.forEach(tab => tab.classList.add('hidden'));
        document.getElementById(button.dataset.page).classList.remove('hidden');
      });
    });

    // Like
    document.querySelectorAll('.like-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const id = this.dataset.id;
        fetch(`/like/${id}/`).then(r => r.json()).then(() => {
          const card = document.getElementById(`property-${id}`);
          card?.remove();
        });
      });
    });

    // Dislike
    document.querySelectorAll('.dislike-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const id = this.dataset.id;
        fetch(`/dislike/${id}/`).then(r => r.json()).then(() => {
          const card = document.getElementById(`property-${id}`);
          card?.remove();
        });
      });
    });

    // Imagem -> abrir modal
    document.querySelectorAll('.property-thumbnail').forEach(img => {
      img.addEventListener('click', function () {
        imageUrls = JSON.parse(this.dataset.images);
        currentImageIndex = 0;
        showImage(currentImageIndex);

        const modal = document.getElementById('fullscreen-modal');
        modal.classList.remove('hidden');
        modal.classList.add('active');
      });
    });

    // Navega√ß√£o
    document.getElementById('prev-image').addEventListener('click', function (e) {
      e.stopPropagation();
      showImage(currentImageIndex - 1);
    });

    document.getElementById('next-image').addEventListener('click', function (e) {
      e.stopPropagation();
      showImage(currentImageIndex + 1);
    });

    document.querySelector('#fullscreen-modal .close').addEventListener('click', function (e) {
      e.stopPropagation();
      closeFullscreen();
    });

    document.getElementById('fullscreen-modal').addEventListener('click', function (e) {
      if (e.target.id === 'fullscreen-modal') closeFullscreen();
    });
  });

  function showImage(index) {
    const modalContent = document.getElementById('modal-content');
    if (!imageUrls.length) return;

    if (index < 0) index = imageUrls.length - 1;
    if (index >= imageUrls.length) index = 0;
    currentImageIndex = index;

    modalContent.innerHTML = '';
    const img = document.createElement('img');
    img.src = imageUrls[currentImageIndex];
    modalContent.appendChild(img);
  }

  function closeFullscreen() {
    const modal = document.getElementById('fullscreen-modal');
    modal.classList.add('hidden');
    modal.classList.remove('active');
    imageUrls = [];
    currentImageIndex = 0;
    document.getElementById('modal-content').innerHTML = '';
  }
</script>


{% endblock %}
