{% extends 'sales/layout.html' %}

{% block title %}MajiM√≥veis | Encontre o im√≥vel ideal{% endblock %}

{% block filter %}
  {% include 'sales/partials/filter_form.html' %}
{% endblock %}

{% block content %}
<div class="container">

  <!-- Bot√µes de navega√ß√£o entre abas -->
  <div class="text-center my-4">
    <button class="btn btn-outline-secondary mx-2" data-page="disliked">üëé Rejeitados</button>
    <button class="btn btn-outline-primary mx-2" data-page="new">üÜï Novos</button>
    <button class="btn btn-outline-success mx-2" data-page="liked">üëç Curtidos</button>
  </div>

  <!-- Aba: Rejeitados -->
  <div id="disliked" class="property-tab hidden">
    <h4 class="mb-3">üëé Im√≥veis Rejeitados</h4>
    <div class="properties-container">
      {% for property in imos_disliked %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Voc√™ ainda n√£o rejeitou nenhum im√≥vel.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Aba: Novos -->
  <div id="new" class="property-tab">
    <h4 class="mb-3">üÜï Novos Im√≥veis</h4>
    <div class="properties-container">
      {% for property in imos %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Nenhum im√≥vel dispon√≠vel no momento.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Aba: Curtidos -->
  <div id="liked" class="property-tab hidden">
    <h4 class="mb-3">üëç Im√≥veis Curtidos</h4>
    <div class="properties-container">
      {% for property in imos_liked %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Voc√™ ainda n√£o curtiu nenhum im√≥vel.</p>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Modal de Imagens -->
<div id="fullscreen-modal" class="fullscreen-modal hidden" onclick="closeFullscreen()">
  <span class="close">&times;</span>
  <div id="modal-content" class="modal-content"></div>
</div>

<!-- Estilo adicional -->
<style>
      .hidden {
    display: none !important;
  }

  .property-tab {
    margin-top: 1rem;
  }

  .properties-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  /* üëâ Scroll horizontal para mobile */
  @media (max-width: 768px) {
    .properties-container {
      overflow-x: auto;
      flex-wrap: nowrap;
      scroll-snap-type: x mandatory;
    }

    .property-card {
      flex: 0 0 auto;
      width: 80%;
      scroll-snap-align: start;
    }
  }

  /* ‚ú® Anima√ß√£o de entrada suave */
  .property-card {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease forwards;
  }

  .property-card:nth-child(1) { animation-delay: 0s; }
  .property-card:nth-child(2) { animation-delay: 0.1s; }
  .property-card:nth-child(3) { animation-delay: 0.2s; }
  .property-card:nth-child(4) { animation-delay: 0.3s; }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Modal fullscreen */
  .fullscreen-modal {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .fullscreen-modal.active {
    display: flex !important;
  }

  .fullscreen-modal .modal-content img {
    max-height: 90vh;
    max-width: 90vw;
  }

  .fullscreen-modal .close {
    position: absolute;
    top: 20px; right: 30px;
    color: white;
    font-size: 2rem;
    cursor: pointer;
  }

  .hidden {
    display: none !important;
  }

  .fullscreen-modal {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .fullscreen-modal.active {
    display: flex !important;
  }

  .fullscreen-modal .modal-content img {
    max-height: 90vh;
    max-width: 90vw;
  }

  .fullscreen-modal .close {
    position: absolute;
    top: 20px; right: 30px;
    color: white;
    font-size: 2rem;
    cursor: pointer;
  }

  .property-tab {
    margin-top: 1rem;
  }
</style>

<!-- Scripts de comportamento -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Altern√¢ncia de abas
    document.querySelectorAll('button[data-page]').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.property-tab').forEach(tab => tab.classList.add('hidden'));
        document.getElementById(button.dataset.page).classList.remove('hidden');
      });
    });

    // CURTIR / REJEITAR
    document.querySelectorAll('.like-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const propertyId = this.dataset.id;
        fetch(`/like/${propertyId}/`).then(r => r.json()).then(data => {
          document.getElementById(`property-${propertyId}`).remove();
        });
      });
    });

    document.querySelectorAll('.dislike-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const propertyId = this.dataset.id;
        fetch(`/dislike/${propertyId}/`).then(r => r.json()).then(data => {
          document.getElementById(`property-${propertyId}`).remove();
        });
      });
    });

    // CLICAR NA IMAGEM PARA ABRIR MODAL
    document.querySelectorAll('.property-thumbnail').forEach(img => {
      img.addEventListener('click', function () {
        const images = JSON.parse(this.dataset.images);
        const modal = document.getElementById('fullscreen-modal');
        const modalContent = document.getElementById('modal-content');

        modalContent.innerHTML = ''; // limpa o conte√∫do
        images.forEach(url => {
          const imageEl = document.createElement('img');
          imageEl.src = url;
          imageEl.style.margin = '1rem';
          modalContent.appendChild(imageEl);
        });

        modal.classList.add('active');
        modal.classList.remove('hidden');
      });
    });

    // Fechar o modal ao clicar no X
    document.querySelector('.fullscreen-modal .close').addEventListener('click', function (event) {
      event.stopPropagation();
      closeFullscreen();
    });

    // Fechar ao clicar fora
    document.getElementById('fullscreen-modal').addEventListener('click', function (e) {
      if (e.target === this) closeFullscreen();
    });
  });

  function toggleDetails(id) {
    const section = document.getElementById(`additional-info-${id}`);
    if (section) {
      section.classList.toggle("hidden");
    }
  }

  function closeFullscreen

{% endblock %}
