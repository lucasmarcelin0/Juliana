{% extends 'sales/layout.html' %}

{% block title %}MajiM√≥veis | Encontre o im√≥vel ideal{% endblock %}

{% block filter %}
  {% include 'sales/partials/filter_form.html' %}
{% endblock %}

{% block content %}
<div class="container">

  <!-- Bot√µes de navega√ß√£o entre abas -->
  <div class="text-center my-4">
    <button class="btn btn-outline-secondary mx-2" data-page="disliked">üëé Rejeitados</button>
    <button class="btn btn-outline-primary mx-2" data-page="new">üÜï Novos</button>
    <button class="btn btn-outline-success mx-2" data-page="liked">üëç Curtidos</button>
  </div>

  <!-- Aba: Rejeitados -->
  <div id="disliked" class="property-tab hidden">
    <h4 class="mb-3">üëé Im√≥veis Rejeitados</h4>
    <div class="properties-container">
      {% for property in imos_disliked %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Voc√™ ainda n√£o rejeitou nenhum im√≥vel.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Aba: Novos -->
  <div id="new" class="property-tab">
    <h4 class="mb-3">üÜï Novos Im√≥veis</h4>
    <div class="properties-container">
      {% for property in imos %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Nenhum im√≥vel dispon√≠vel no momento.</p>
      {% endfor %}
    </div>
  </div>

  <!-- Aba: Curtidos -->
  <div id="liked" class="property-tab hidden">
    <h4 class="mb-3">üëç Im√≥veis Curtidos</h4>
    <div class="properties-container">
      {% for property in imos_liked %}
        {% include 'sales/partials/property_card.html' with property=property %}
      {% empty %}
        <p class="text-muted">Voc√™ ainda n√£o curtiu nenhum im√≥vel.</p>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Modal de Imagens -->
<div id="fullscreen-modal" class="fullscreen-modal hidden" onclick="closeFullscreen()">
  <span class="close">&times;</span>
  <div id="modal-content" class="modal-content"></div>
</div>

<!-- Estilo adicional -->
<style>
      .hidden {
    display: none !important;
  }

  .property-tab {
    margin-top: 1rem;
  }

  .properties-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  /* üëâ Scroll horizontal para mobile */
  @media (max-width: 768px) {
    .properties-container {
      overflow-x: auto;
      flex-wrap: nowrap;
      scroll-snap-type: x mandatory;
    }

    .property-card {
      flex: 0 0 auto;
      width: 80%;
      scroll-snap-align: start;
    }
  }

  /* ‚ú® Anima√ß√£o de entrada suave */
  .property-card {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease forwards;
  }

  .property-card:nth-child(1) { animation-delay: 0s; }
  .property-card:nth-child(2) { animation-delay: 0.1s; }
  .property-card:nth-child(3) { animation-delay: 0.2s; }
  .property-card:nth-child(4) { animation-delay: 0.3s; }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Modal fullscreen */
  .fullscreen-modal {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .fullscreen-modal.active {
    display: flex !important;
  }

  .fullscreen-modal .modal-content img {
    max-height: 90vh;
    max-width: 90vw;
  }

  .fullscreen-modal .close {
    position: absolute;
    top: 20px; right: 30px;
    color: white;
    font-size: 2rem;
    cursor: pointer;
  }

  .hidden {
    display: none !important;
  }

  .fullscreen-modal {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .fullscreen-modal.active {
    display: flex !important;
  }

  .fullscreen-modal .modal-content img {
    max-height: 90vh;
    max-width: 90vw;
  }

  .fullscreen-modal .close {
    position: absolute;
    top: 20px; right: 30px;
    color: white;
    font-size: 2rem;
    cursor: pointer;
  }

  .property-tab {
    margin-top: 1rem;
  }
</style>

<!-- Scripts de comportamento -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Altern√¢ncia de abas
    const buttons = document.querySelectorAll('button[data-page]');
    const tabs = document.querySelectorAll('.property-tab');

    buttons.forEach(button => {
      button.addEventListener('click', () => {
        tabs.forEach(tab => tab.classList.add('hidden'));
        const target = document.getElementById(button.dataset.page);
        target.classList.remove('hidden');
      });
    });
  });

  // Modal de imagens
  function showAllImages(div) {
    const images = div.querySelectorAll('img');
    const modalContent = document.getElementById('modal-content');
    const modal = document.getElementById('fullscreen-modal');

    modalContent.innerHTML = '';
    images.forEach(img => {
      const clone = img.cloneNode();
      clone.classList.remove('hidden-image');
      clone.style.margin = '0.5rem';
      modalContent.appendChild(clone);
    });

    modal.classList.remove('hidden');
    modal.classList.add('active');
  }

  function closeFullscreen() {
    const modal = document.getElementById('fullscreen-modal');
    modal.classList.remove('active');
    modal.classList.add('hidden');
  }
</script>
{% endblock %}
