{% load static %}

<!DOCTYPE html>
<html lang="pt-br">

<head>

    <style>
/* Top Navbar Styling */
/* Top Navbar Styling */
.top-navbar {
    background-color: #4A90E2;  /* Use a color similar to the one in your image */
    color: #fff;               
    padding: 10px 0;           /* Less padding for a more compact look */
    position: sticky;          /* Sticks to the top on scroll */
    top: 0;
    width: 100%;
    z-index: 100;              /* Ensures it's above other elements */
    display: flex;
    justify-content: center;   /* Center the items */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

/* Navbar Container */
.navbar-container {
    display: flex;
    width: 100%;
    max-width: 1200px;         /* Limit max-width for a centered look */
    justify-content: space-around;  /* Spread items evenly across the bar */
    align-items: center;
}

/* Individual Navbar Item */
.navbar-item {
    flex: 1;
    display: flex;
    justify-content: center;
}

/* Icon Button Styles */
.icon-button {
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    font-size: 24px;
    transition: transform 0.2s, color 0.2s;
}

.icon-button:hover {
    color: #f0f0f0;            /* Slightly lighter color on hover */
    transform: scale(1.1);     /* Slight zoom-in on hover */
}

/* Icon Styling for Links */
.navbar-item a {
    color: #fff;
    font-size: 24px;
    transition: transform 0.2s, color 0.2s;
}

.navbar-item a:hover {
    color: #f0f0f0;            /* Slightly lighter color on hover */
    transform: scale(1.1);     /* Slight zoom-in on hover */
}













/* Container for all properties */
.properties-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: space-around;
}

/* Individual property card for 2-column layout */
.property-card {
    flex: 1 1 calc(50% - 20px); /* 2-column layout with consistent gap */
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
    box-sizing: border-box;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    margin-bottom: 20px;
}

/* Responsive adjustments for small screens (1 column) */
@media (max-width: 768px) {
    .property-card {
        flex: 1 1 100%; /* 1-column layout for small screens */
    }
}






/* Property Media Section */
.property-media {
    display: flex;
    gap: 20px;
    flex-wrap: wrap; /* Allow wrapping in case of smaller screens */
}

/* Photo section styling */
.property-photo {
    flex: 1;
    width: 100%; /* Make sure it takes full width if the card size changes */
    max-width: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.property-image {
    width: 100%;
    height: auto;
    border-radius: 4px;
    object-fit: cover;
}

/* Video section styling */
.property-video {
    flex: 1;
    width: 100%; /* Ensure full width if necessary */
    max-width: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px dashed #ccc;
    height: 250px;
    color: #999;
}

/* Main Property Information */
.property-info {
    margin-top: 15px;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 4px;
}

/* Additional Information */
.property-info-extra {
    background: #f1f1f1;
    padding: 10px;
    border-radius: 4px;
    margin-top: 10px;
    display: none; /* Ensure hidden by default */
}

/* Button to toggle additional info */
button {
    margin-top: 10px;
    padding: 8px 12px;
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background: #0056b3;
}












/* Fullscreen modal styling */
.fullscreen-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.9);
}

.modal-content {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin: 5% auto;
    max-width: 90%;
}

.modal-content img {
    width: 45%;
    margin: 5px;
    border-radius: 5px;
}

.close {
    position: absolute;
    top: 20px;
    right: 35px;
    color: #fff;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
}

/* Responsive styling for larger screens */
@media (min-width: 768px) {
    .property-card {
        width: 45%; /* Display two cards side by side on wider screens */
    }
}


/* Photo section styling */
.property-photo {
    flex: 1;
    max-height: 250px; /* Adjust this value as needed */
    overflow: hidden; /* Hide anything that overflows */
    display: flex;
    align-items: center;
    justify-content: center;
}

.property-image {
    max-width: 100%;
    max-height: 100%;
    width: auto;  /* Make sure images keep their aspect ratio */
    height: auto; /* Make sure images keep their aspect ratio */
    border-radius: 4px;
    object-fit: cover; /* Ensures images don't distort */
}





/* Formulário de Filtro */
.filter-form button {
    padding: 10px 20px;
    background-color: #4A90E2;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.filter-form button:hover {
    background-color: #0056b3;
}


/* Formulário de Filtro (Inicialmente Oculto) */
.hidden {
    display: none;
}








.perfil-container {
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.perfil-container h2 {
    margin-bottom: 20px;
    text-align: center;
    color: #333;
}

.perfil-container p {
    font-size: 18px;
    margin-bottom: 10px;
}







/* Filter Form Container */
.filter-form-container {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    max-width: 1200px; /* Increased width for a 4-column layout */
    margin: 20px auto;
    transition: all 0.3s ease;
}

/* Filter Form Styling (Form Fields) */
.filter-form {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
}

.filter-field {
    flex: 1 1 calc(25% - 20px); /* 4-column layout */
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
}

.filter-field label {
    margin-bottom: 5px;
    font-weight: bold;
    color: #333;
}

.filter-field input,
.filter-field select {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    transition: all 0.3s ease;
    outline: none;
    font-size: 16px;
}

.filter-field input:focus,
.filter-field select:focus {
    border-color: #4A90E2;
    box-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
}

/* Apply Filters Button */
#apply-filters {
    padding: 12px 20px;
    background-color: #4A90E2;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 10px;
    align-self: flex-start;
    transition: background-color 0.3s ease;
}

#apply-filters:hover {
    background-color: #0056b3;
}

/* Responsive adjustments for medium screens (2-column layout) */
@media (max-width: 1024px) {
    .filter-field {
        flex: 1 1 calc(50% - 20px); /* 2-column layout */
    }

    .filter-form-container {
        padding: 15px;
    }
}

/* Responsive adjustments for smaller screens (1-column layout) */
@media (max-width: 768px) {
    .filter-field {
        flex: 1 1 100%; /* 1-column layout */
    }

    .filter-form-container {
        padding: 15px;
    }

    #apply-filters {
        width: 100%;
        text-align: center;
    }
}



</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the filter button and filter form container
        const filterButton = document.querySelector('.filter-button');
        const filterFormContainer = document.getElementById('filter-form-container');

        // Initialize the filter button toggle
        if (filterButton && filterFormContainer && (window.location.pathname === '/' || window.location.pathname.includes('index'))) {
            filterButton.addEventListener('click', function (event) {
                event.preventDefault(); // Prevent default behavior
                filterFormContainer.style.display = (filterFormContainer.style.display === 'none' || filterFormContainer.style.display === '') ? 'block' : 'none';
            });
        }

        // Initialize the apply filters button
        const applyFiltersButton = document.getElementById('apply-filters');
        if (applyFiltersButton) {
            applyFiltersButton.addEventListener('click', function () {
                console.log("Apply Filters button clicked."); // Log when button is clicked

                // Gather filter form data
                const formData = new FormData(document.getElementById('filter-form'));
                const queryParams = new URLSearchParams(formData).toString();
                const timestamp = new Date().getTime(); // Add timestamp to prevent caching
                const url = `/filter_properties/?${queryParams}&_=${timestamp}`;

                // Make the request using fetch
                fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    console.log('Fetch request completed with status:', response.status); // Log the status code
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error(`Server responded with status ${response.status}`);
                    }
                })
                .then(data => {
                    console.log('Fetch response data:', data); // Log the response data
                    renderProperties(data.properties);
                })
                .catch(error => {
                    console.error('Error loading properties:', error);
                });
            });
        }

        // Event delegation for details button click
        document.addEventListener('click', function (event) {
            if (event.target && event.target.classList.contains('details-button')) {
                const propertyId = event.target.getAttribute('data-id');
                toggleDetails(propertyId);
            }
        });
    });

    // Function to render properties in the container
    function renderProperties(properties) {
        const propertiesContainer = document.getElementById('properties-container');
        const renderedPropertyIds = new Set(); // Track already rendered properties to avoid duplicates

        if (propertiesContainer) {
            // Clear existing cards to avoid duplicates
            propertiesContainer.innerHTML = '';

            if (properties && properties.length > 0) {
                properties.forEach(property => {
                    // Skip rendering if the property is already in the set
                    if (renderedPropertyIds.has(property.id)) {
                        return;
                    }

                    renderedPropertyIds.add(property.id); // Add property ID to the set to track it
                    console.log('Appending property:', property);

                    const propertyCard = document.createElement('div');
                    propertyCard.classList.add('property-card');
                    propertyCard.setAttribute('id', `property-${property.id}`);

                    // Check if images exist, and if not, use a fallback
                    let propertyImagesHtml = '<p>No images available</p>';
                    if (property.images && Array.isArray(property.images) && property.images.length > 0) {
                        propertyImagesHtml = property.images.map((image, index) => {
                            return `<img src="${image.url}" alt="Property Image" class="property-image ${index === 0 ? 'first-image' : 'hidden'}">`;
                        }).join('');
                    }

                    // Set the HTML content of the property card
                    propertyCard.innerHTML = `
                        <div class="property-media">
                            <div class="property-photo" onclick="showAllImages(this)">
                                ${propertyImagesHtml}
                            </div>
                            <div class="property-video">
                                ${property.video_url ? `<iframe 
                                    src="${property.video_url}" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                                </iframe>` : '<p>Video Section Coming Soon</p>'}
                            </div>
                        </div>
                        <div class="property-info">
                            <p><strong>Endereço:</strong> ${property.street || 'Não especificado'}, ${property.street_number || 'N/A'}, ${property.neighborhood || 'N/A'}, ${property.city || 'N/A'}, ${property.state || 'N/A'}</p>
                            <p><strong>Preço:</strong> R$ ${property.sale_price || property.rent_price || 'N/A'}</p>
                            <p><strong>Alugar/Comprar:</strong> ${property.sale_price ? 'Comprar' : 'Alugar'}</p>
                        </div>
                        <button type="button" class="details-button" data-id="${property.id}">Ver mais detalhes</button>
                        <div id="additional-info-${property.id}" class="property-info hidden">
                            <p><strong>Área do Imóvel:</strong> ${property.property_area || 'N/A'} m²</p>
                            <p><strong>Quartos:</strong> ${property.bedrooms || 'N/A'}</p>
                            <p><strong>Suítes:</strong> ${property.suites || 'N/A'}</p>
                            <p><strong>Banheiros:</strong> ${property.bathrooms || 'N/A'}</p>
                            <p><strong>Características:</strong> ${property.features || 'N/A'}</p>
                            <p><strong>Área Privativa:</strong> ${property.private_area || 'N/A'} m²</p>
                            <p><strong>Vagas de Garagem:</strong> ${property.garage_spots || 'N/A'}</p>
                            <p><strong>Tipo de Garagem:</strong> ${property.garage_type || 'N/A'}</p>
                            <p><strong>Tem Piscina:</strong> ${property.has_pool ? 'Sim' : 'Não'}</p>
                            <p><strong>Portaria:</strong> ${property.has_gatehouse || 'N/A'}</p>
                            <p><strong>Condição:</strong> ${property.is_occupied || 'N/A'}</p>
                            <p><strong>Acessibilidade:</strong> ${property.accessibility || 'N/A'}</p>
                            <p><strong>Data de Disponibilidade para Mudança:</strong> ${property.move_availability || 'N/A'}</p>
                            <p><strong>Preço do Aluguel:</strong> R$ ${property.rent_price || 'N/A'}</p>
                            <p><strong>Preço de Venda:</strong> R$ ${property.sale_price || 'N/A'}</p>
                            <p><strong>Valor do IPTU:</strong> R$ ${property.iptu_value || 'N/A'}</p>
                            <p><strong>Taxa de Condomínio:</strong> R$ ${property.condo_fee || 'N/A'}</p>
                            <p><strong>Descrição Livre:</strong> ${property.free_description || 'N/A'}</p>
                        </div>
                    `;

                    // Append the card to the container
                    propertiesContainer.appendChild(propertyCard);
                });
            } else {
                console.warn('No properties found.');
                propertiesContainer.innerHTML = '<p>No properties matched your criteria.</p>';
            }
        }
    }

    function showAllImages(element) {
        const images = element.querySelectorAll('.property-image:not(.first-image)');
        const currentlyVisible = Array.from(images).every(img => !img.classList.contains('hidden'));

        images.forEach((img) => {
            img.classList.toggle('hidden', currentlyVisible);
        });

        if (!currentlyVisible) {
            openFullscreenModal(element);
        }

        element.style.cursor = currentlyVisible ? 'pointer' : 'zoom-out';
    }

    function openFullscreenModal(element) {
        const modal = document.getElementById("fullscreen-modal");
        const modalContent = document.getElementById("modal-content");

        // Clear any previous content in the modal
        modalContent.innerHTML = "";

        // Add all images from the clicked container to the modal
        const images = element.querySelectorAll('.property-image');
        images.forEach((img) => {
            const modalImg = img.cloneNode(true);
            modalContent.appendChild(modalImg);
        });

        // Show the modal
        modal.style.display = "block";
    }

    function closeFullscreen() {
        const modal = document.getElementById("fullscreen-modal");
        modal.style.display = "none";
    }

    function toggleDetails(counter) {
        console.log("Toggle ID: ", counter);
        const additionalInfo = document.getElementById(`additional-info-${counter}`);
        if (additionalInfo) {
            additionalInfo.classList.toggle('hidden');
        } else {
            console.error('Element not found for ID:', counter);
        }
    }
</script>

</head>

<body>
    <!-- Header Section -->
<!-- Header Section -->
<header class="top-navbar">
    <div class="navbar-container">
        <!-- Profile Icon -->
        <div class="navbar-item">
            <a href="/perfil">
                <i class="fas fa-user-circle"></i>
            </a>
        </div>

<!-- Filter Icon -->
<div class="navbar-item">
    <a href="/">
        <button class="filter-button icon-button">
            <i class="fas fa-search"></i>
        </button>
    </a>
</div>

        <!-- Add Property Icon -->
        <div class="navbar-item">
            <a href="/admin/sales/property/add/">
                <i class="fas fa-plus-circle"></i>
            </a>
        </div>
    </div>
</header>

<!-- Link to FontAwesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

</header>

    <!-- Main Content Section -->
    <main>

        {% block filter %}
        {% endblock %}


        {% block content %}
        {% endblock %}
    </main>
</body>

</html>
