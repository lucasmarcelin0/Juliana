<div class="property-card shadow-sm rounded-4 border bg-white p-3 mb-4" id="property-{{ property.id }}">

  <!-- MÃ­dia do imÃ³vel -->
  <div class="property-media row g-3 mb-3 align-items-stretch">

    <!-- Imagem -->
    <div class="col-md-6">
      {% if property.images.first %}
        <img src="{{ property.images.first.image.url }}"
             alt="Imagem do ImÃ³vel"
             class="img-fluid rounded shadow-sm w-100 h-100 object-fit-cover"
             style="cursor:pointer; max-height: 300px;"
             onclick="openGallery({{ property.id }})">
      {% else %}
        <div class="bg-light rounded shadow-sm d-flex align-items-center justify-content-center" style="height: 220px;">
          <span class="text-muted">Sem imagem</span>
        </div>
      {% endif %}
    </div>

    <!-- VÃ­deo -->
    <div class="col-md-6">
      {% if property.video_url %}
        <div class="ratio ratio-16x9 h-100">
          <iframe src="{{ property.video_url }}"
                  allowfullscreen
                  class="rounded border w-100 h-100"></iframe>
        </div>
      {% else %}
        <div class="bg-light rounded shadow-sm d-flex align-items-center justify-content-center" style="height: 220px;">
          <span class="text-muted">Sem vÃ­deo</span>
        </div>
      {% endif %}
    </div>

    <!-- Modal de Galeria -->
    {% if property.images.count > 0 %}
    <div id="gallery-modal-{{ property.id }}" class="gallery-modal d-none">
      <div class="gallery-backdrop" onclick="closeGallery({{ property.id }})"></div>
      <div class="gallery-content">
        <span class="gallery-close" onclick="closeGallery({{ property.id }})">&times;</span>
        {% for image in property.images.all %}
          <img src="{{ image.image.url }}" class="gallery-image mb-2">
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>

  <!-- InformaÃ§Ãµes principais -->
  <div class="property-info mb-3">
    <p class="mb-1"><i class="fas fa-map-marker-alt text-primary"></i>
      <strong>{{ property.street }}, {{ property.street_number }}</strong> - {{ property.neighborhood }}, {{ property.city }} - {{ property.state }}
    </p>
    <p class="mb-1"><i class="fas fa-coins text-success"></i>
      <strong>R$ {{ property.sale_price|default:property.rent_price }}</strong>
      {% if property.sale_price %}
        <span class="badge bg-success ms-2">Venda</span>
      {% else %}
        <span class="badge bg-primary ms-2">Aluguel</span>
      {% endif %}
    </p>
  </div>

  <!-- AÃ§Ãµes -->
  <div class="d-flex justify-content-start gap-2 mb-3">
    <button class="btn btn-outline-success btn-sm like-btn" data-id="{{ property.id }}">ðŸ”¥ Curtir</button>
    <button class="btn btn-outline-danger btn-sm dislike-btn" data-id="{{ property.id }}">ðŸ’¡ Rejeitar</button>
    <button type="button" class="btn btn-outline-primary btn-sm" onclick="toggleDetails({{ property.id }})">ðŸ“˜ Detalhes</button>
  </div>

  <!-- Detalhes -->
  <div id="additional-info-{{ property.id }}" class="property-info hidden mt-3 border-top pt-3 small">
    <!-- ... mantenha as informaÃ§Ãµes detalhadas como antes ... -->
  </div>

  <!-- CSS -->
  <style>
    .gallery-modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 9999;
      display: flex; justify-content: center; align-items: center;
      flex-wrap: wrap; padding: 2rem; overflow-y: auto;
    }

    .gallery-backdrop {
      position: absolute; width: 100%; height: 100%;
      background: transparent; top: 0; left: 0; z-index: 1;
    }

    .gallery-content {
      z-index: 2; max-width: 90%;
      display: flex; flex-direction: column; align-items: center;
    }

    .gallery-image {
      max-width: 100%;
      border-radius: 8px;
      box-shadow: 0 0 10px #000;
    }

    .gallery-close {
      font-size: 2rem;
      color: white;
      cursor: pointer;
      align-self: flex-end;
      margin-bottom: 1rem;
    }

    .object-fit-cover {
      object-fit: cover;
    }

    .hidden {
      display: none !important;
    }
  </style>

  <!-- JS -->
  <script>
    function openGallery(id) {
      const modal = document.getElementById(`gallery-modal-${id}`);
      if (modal) modal.classList.remove("d-none");
    }

    function closeGallery(id) {
      const modal = document.getElementById(`gallery-modal-${id}`);
      if (modal) modal.classList.add("d-none");
    }

    function toggleDetails(id) {
      const section = document.getElementById(`additional-info-${id}`);
      if (section) {
        section.classList.toggle("hidden");
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll('.like-btn').forEach(btn => {
        btn.addEventListener("click", function () {
          const propertyId = this.dataset.id;
          fetch(`/like/${propertyId}/`)
            .then(r => r.json())
            .then(data => {
              this.classList.toggle("btn-success", data.liked);
              this.classList.toggle("btn-outline-success", !data.liked);
              const dislikeBtn = document.querySelector(`.dislike-btn[data-id="${propertyId}"]`);
              if (dislikeBtn) {
                dislikeBtn.classList.remove("btn-danger");
                dislikeBtn.classList.add("btn-outline-danger");
              }
              document.getElementById(`property-${propertyId}`).remove(); // remove do DOM
            });
        });
      });

      document.querySelectorAll('.dislike-btn').forEach(btn => {
        btn.addEventListener("click", function () {
          const propertyId = this.dataset.id;
          fetch(`/dislike/${propertyId}/`)
            .then(r => r.json())
            .then(data => {
              this.classList.toggle("btn-danger", data.disliked);
              this.classList.toggle("btn-outline-danger", !data.disliked);
              const likeBtn = document.querySelector(`.like-btn[data-id="${propertyId}"]`);
              if (likeBtn) {
                likeBtn.classList.remove("btn-success");
                likeBtn.classList.add("btn-outline-success");
              }
              document.getElementById(`property-${propertyId}`).remove(); // remove do DOM
            });
        });
      });
    });
  </script>
</div>
